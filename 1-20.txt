1.# Q1 – Tiny REST-style service for Library Books

books = []

def add_book(data):
    if not isinstance(data, dict) or "title" not in data or "status" not in data:
        return {"error": "Invalid payload"}
    books.append(data)
    return {"message": "Book added", "data": data}

def list_books(query=None):
    if query and "status" in query:
        return [b for b in books if b["status"] == query["status"]]
    return books

def get_stats():
    return {
        "total": len(books),
        "available": sum(1 for b in books if b["status"] == "available"),
        "issued": sum(1 for b in books if b["status"] == "issued"),
    }

def router(request_string, payload=None):
    try:
        method, path = request_string.split()
    except:
        return {"error": "Malformed request"}

    if method not in ["GET", "POST"]:
        return {"error": "Invalid method"}

    if path == "/items":
        if method == "POST":
            return add_book(payload)
        elif method == "GET":
            return list_books(payload)
    elif path == "/stats" and method == "GET":
        return get_stats()

    return {"error": "Unknown path"}

# Example
print(router("POST /items", {"title": "Python 101", "status": "available"}))
print(router("GET /items"))


2.# Q2 – Normalize JSON/YAML structures

import json
import yaml

def normalize_keys(d):
    if isinstance(d, dict):
        return {k.lower(): normalize_keys(v) for k, v in d.items()}
    elif isinstance(d, list):
        return [normalize_keys(i) for i in d]
    return d

def tidy_config(file_path, output_path):
    if file_path.endswith(".json"):
        data = json.load(open(file_path))
    else:
        data = yaml.safe_load(open(file_path))

    cleaned = normalize_keys(data)

    with open(output_path, "w") as f:
        json.dump(cleaned, f, indent=4)

    return cleaned

# Example usage
print(normalize_keys({"Site": "Bangalore", "Devices": 12}))


3.# Q3 – Student classification

def classify_student(attendance, marks):
    avg = sum(marks) / len(marks)

    if attendance > 90 and avg > 85:
        return "Excellent"
    elif attendance >= 75 and avg >= 60:
        return "On Track"
    elif attendance >= 60 and avg >= 40:
        return "At Risk"
    else:
        return "Failing"

# Example
attendance = 88
marks = [45, 67, 89, 23, 56]
print(classify_student(attendance, marks))


4.# Q4 – Mock API with retry + backoff

import time
import random

log = []

def fake_api_call():
    # 30% failure chance
    if random.random() < 0.3:
        return {"success": False, "error": "Temporary failure"}
    return {"success": True, "data": random.randint(100, 999)}

def poll_with_retry(max_retries=3):
    attempt = 0
    while attempt < max_retries:
        result = fake_api_call()
        log.append({"attempt": attempt + 1, "result": result})

        if result["success"]:
            return result

        attempt += 1
        time.sleep(attempt)  # backoff 1 → 2 → 3 sec

    return {"success": False, "error": "All retries failed"}

print(poll_with_retry())
print("Log:", log)

5.# Q5 – Filter only warnings/errors with safe error handling

import logging

logging.basicConfig(filename="audit.log", level=logging.INFO)

def process_logs(lines):
    processed = 0
    failed = 0

    for line in lines:
        try:
            processed += 1
            if "ERROR" in line or "WARNING" in line:
                logging.info(line)
        except Exception as e:
            failed += 1
            logging.error(f"Failed to process line: {e}")

    return {"processed": processed, "failed": failed}

# Example
print(process_logs(["INFO: OK", "ERROR: Timeout", "WARNING: Low memory"]))

6.# Q6 – Tiny REST-style Orders API

orders = []

def add_order(data):
    if not isinstance(data, dict) or "order_id" not in data:
        return {"error": "Invalid order payload"}
    orders.append(data)
    return {"message": "Order added"}

def list_orders():
    return orders

def search_orders(keyword):
    return [o for o in orders if keyword.lower() in str(o).lower()]

def router(request, payload=None):
    method, path = request.split()

    if path != "/items":
        return {"error": "Unknown path"}

    if method == "POST":
        return add_order(payload)
    elif method == "GET":
        if payload and "search" in payload:
            return search_orders(payload["search"])
        return list_orders()

    return {"error": "Invalid method"}

# Example
print(router("POST /items", {"order_id": 1, "customer": "John"}))
print(router("GET /items"))


7.# Q7 – Split JSON/YAML collections by key

import json
import yaml
import os

def split_by_key(file_path, key):
    data = yaml.safe_load(open(file_path)) if file_path.endswith(".yaml") else json.load(open(file_path))

    buckets = {}
    for item in data:
        k = item.get(key, "unknown")
        buckets.setdefault(k, []).append(item)

    for group, items in buckets.items():
        with open(f"{group}.json", "w") as f:
            json.dump(items, f, indent=4)

    return buckets


8.# Q8 – Classify machines based on CPU + active users

def classify_machine(cpu, users):
    if cpu < 20 and users == 0:
        return "Idle"
    elif cpu < 50:
        return "Normal"
    elif cpu < 80:
        return "Busy"
    else:
        return "Overloaded"

# Example dataset
machines = [
    {"cpu": 45, "users": 2},
    {"cpu": 89, "users": 4},
]

for m in machines:
    print(classify_machine(m["cpu"], m["users"]))


9.# Q9 – Mock paginated API

log = []

pages = [
    {"data": [1, 2, 3], "next": True},
    {"data": [4, 5, 6], "next": True},
    {"data": [7, 8, 9], "next": False},
]

def get_page(i):
    if i >= len(pages):
        return {"error": "No such page"}
    return pages[i]

def read_all_pages():
    index = 0
    result = []

    while True:
        page = get_page(index)
        log.append(f"Fetched page {index}")

        if "error" in page:
            log.append(f"Error: {page['error']}")
            break

        result.extend(page["data"])

        if not page["next"]:
            break
        index += 1

    return result

print(read_all_pages())
print("Log:", log)


10.# Q10 – TCP echo service with exception-safe logging

import socket
import logging

logging.basicConfig(filename="echo.log", level=logging.INFO)

def start_echo(port=5000):
    processed = 0
    failed = 0

    s = socket.socket()
    s.bind(("127.0.0.1", port))
    s.listen(1)

    while True:
        try:
            conn, addr = s.accept()
            data = conn.recv(1024)
            processed += 1

            logging.info(f"Raw: {data}")
            logging.info(f"Decoded: {data.decode(errors='ignore')}")

            conn.sendall(data)  # echo back
            conn.close()
        except Exception as e:
            failed += 1
            logging.error(f"Failure: {e}")

        if processed > 5:   # stop after few messages (demo only)
            break

    return {"processed": processed, "failed": failed}

print(start_echo())


-------------------------------------------------------------------------

11.# Q11 – In-memory contact book

contacts = {}

def add_contact(name, phone):
    contacts[name] = phone      # Overwrites automatically
    return {"message": "Saved", "name": name, "phone": phone}

def list_contacts():
    return contacts

def search_contact(keyword):
    return {name: ph for name, ph in contacts.items() if keyword.lower() in name.lower()}

# Example
add_contact("John", "9999")
add_contact("Johnny", "7777")
print(list_contacts())
print(search_contact("john"))


12.# Q12 – CLI menu loop

def menu():
    items = []

    while True:
        print("\n1. Add Item\n2. List Items\n3. Delete by Index\n4. Exit")
        choice = input("Enter choice: ")

        if choice == "1":
            item = input("Enter item: ")
            items.append(item)
        elif choice == "2":
            print("Items:", items)
        elif choice == "3":
            idx = int(input("Enter index: "))
            if 0 <= idx < len(items):
                items.pop(idx)
        elif choice == "4":
            break
        else:
            print("Invalid choice")

# menu()  # Uncomment to run


13.# Q13 – Simple CSV parser

def parse_csv(path):
    rows = []
    with open(path) as f:
        for line in f:
            line = line.strip()
            if line:
                rows.append(line.split(","))
    return rows

# Example
# print(parse_csv("data.csv"))


14.
# Q14 – Backup a file by renaming with a timestamp

import os
from datetime import datetime

def backup_file(path):
    if not os.path.exists(path):
        return {"error": "File not found"}

    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_name = f"{path}.{timestamp}.bak"

    os.rename(path, backup_name)
    return {"backup_file": backup_name}

# Example
# print(backup_file("config.json"))


15.
# Q15 – Notification queue using list

queue = []

def push(msg):
    queue.append(msg)

def pop():
    if queue:
        return queue.pop(0)
    return None

def size():
    return len(queue)

# Example
push("Hello")
push("World")
print(pop())  # Hello
print(size())


16.# Q16 – Aggregate statuses

def aggregate_status(logs):
    result = {"OK": 0, "WARN": 0, "ERROR": 0}

    for entry in logs:
        status = entry.get("status")
        if status in result:
            result[status] += 1

    return result

# Example
logs = [
    {"id": 1, "status": "OK"},
    {"id": 2, "status": "WARN"},
    {"id": 3, "status": "ERROR"},
    {"id": 4, "status": "OK"}
]

print(aggregate_status(logs))

17.# Q17 – Merge two JSON-like dicts

def merge_json(a, b):
    result = a.copy()
    for k, v in b.items():
        result[k] = v  # overwrite
    return result

# Example
a = {"name": "Alice", "city": "Delhi"}
b = {"city": "Mumbai", "age": 25}

print(merge_json(a, b))

18.
# Q18 – Tiny rule engine

def evaluate(data):
    val = data.get("value", 0)

    if val < 10:
        return "LOW"
    elif val < 50:
        return "MEDIUM"
    elif val < 90:
        return "HIGH"
    else:
        return "CRITICAL"

# Example
print(evaluate({"value": 72}))

19.
# Q19 – Math evaluator

def math_cli():
    print("Enter expressions like '3 + 5' or '7 * 9'")
    while True:
        expr = input(">> ")
        if expr.lower() == "exit":
            break
        try:
            print("=", eval(expr))
        except:
            print("Invalid expression")

# math_cli()  # Uncomment to run


20.

# Q20 – Tiny template engine {{key}}

def render(template_str, data):
    out = template_str
    for key, value in data.items():
        out = out.replace("{{" + key + "}}", str(value))
    return out

# Example
template = "Hello {{name}}, your score is {{score}}!"
data = {"name": "John", "score": 95}

print(render(template, data))


----------------------------------------------------------------